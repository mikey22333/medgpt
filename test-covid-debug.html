<!DOCTYPE html>
<html>
<head>
    <title>COVID-19 Research Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .console { background: #1e1e1e; color: #fff; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .button { background: #007acc; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .button:hover { background: #005a9e; }
    </style>
</head>
<body>
    <h1>üß™ COVID-19 Research System Debug Test</h1>
    <p>This test will check if the research system returns relevant COVID-19 papers for the query:</p>
    <p><strong>"long-term effects of COVID-19 on cardiovascular system"</strong></p>
    
    <button class="button" onclick="runDebugTest()">üöÄ Run Debug Test</button>
    
    <div id="results"></div>
    
    <script>
        async function runDebugTest() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="console">üîÑ Running test... Check browser console for detailed output.</div>';
            
            try {
                console.log('üß™ DEBUGGING COVID-19 Research System...');
                
                const query = "long-term effects of COVID-19 on cardiovascular system";
                console.log(`Query: "${query}"`);
                
                const startTime = Date.now();
                
                const response = await fetch('/api/research', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        maxResults: 8,
                        includeAbstracts: true
                    })
                });

                const duration = Date.now() - startTime;
                console.log(`‚è±Ô∏è Request took ${duration}ms`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`‚ùå API Error ${response.status}:`, errorText);
                    resultsDiv.innerHTML = `<div class="console">‚ùå API Error ${response.status}: ${errorText}</div>`;
                    return;
                }

                const data = await response.json();
                
                console.log(`üìä RESEARCH RESULTS ANALYSIS:`);
                console.log(`Total papers found: ${data.papers?.length || 0}`);
                
                let results = `<div class="console">`;
                results += `<h3>üìä RESEARCH RESULTS ANALYSIS</h3>`;
                results += `<p>Total papers found: ${data.papers?.length || 0}</p>`;
                
                if (data.papers && data.papers.length > 0) {
                    let covidRelevant = 0;
                    let medicalRelevant = 0;
                    let totallyIrrelevant = 0;
                    
                    results += `<h3>üìë PAPERS FOUND:</h3>`;
                    
                    data.papers.forEach((paper, index) => {
                        const title = (paper.title || '').toLowerCase();
                        const abstract = (paper.abstract || '').toLowerCase();
                        const combined = `${title} ${abstract}`;
                        
                        const isCovidRelated = [
                            'covid', 'covid-19', 'sars-cov-2', 'coronavirus',
                            'long covid', 'post covid', 'pandemic'
                        ].some(term => combined.includes(term));
                        
                        const isMedical = [
                            'patient', 'clinical', 'medical', 'health', 'disease',
                            'treatment', 'therapy', 'hospital', 'doctor'
                        ].some(term => combined.includes(term));
                        
                        const isIrrelevant = [
                            'machine learning', 'lstm', 'neural network', 'algorithm',
                            'software', 'model', 'fitting', 'statistical', 'mathematics',
                            'physics', 'chemistry', 'engineering', 'computer science'
                        ].some(term => combined.includes(term)) && !isMedical;
                        
                        results += `<p><strong>${index + 1}. ${paper.title}</strong><br>`;
                        results += `Journal: ${paper.journal || 'Unknown'}<br>`;
                        results += `Source: ${paper.source || 'Unknown'}<br>`;
                        results += `COVID Related: ${isCovidRelated ? '‚úÖ' : '‚ùå'} | `;
                        results += `Medical: ${isMedical ? '‚úÖ' : '‚ùå'} | `;
                        results += `Relevant: ${isIrrelevant ? '‚ùå' : '‚úÖ'}</p>`;
                        
                        if (isCovidRelated) covidRelevant++;
                        if (isMedical) medicalRelevant++;
                        if (isIrrelevant) totallyIrrelevant++;
                        
                        console.log(`${index + 1}. ${paper.title}`);
                        console.log(`   COVID Related: ${isCovidRelated ? '‚úÖ' : '‚ùå'}`);
                        console.log(`   Medical: ${isMedical ? '‚úÖ' : '‚ùå'}`);
                    });
                    
                    results += `<h3>üìà RELEVANCE SUMMARY:</h3>`;
                    results += `<p>COVID-19 Related: ${covidRelevant}/${data.papers.length} (${Math.round(covidRelevant/data.papers.length*100)}%)</p>`;
                    results += `<p>Medical Related: ${medicalRelevant}/${data.papers.length} (${Math.round(medicalRelevant/data.papers.length*100)}%)</p>`;
                    results += `<p>Completely Irrelevant: ${totallyIrrelevant}/${data.papers.length} (${Math.round(totallyIrrelevant/data.papers.length*100)}%)</p>`;
                    
                    if (covidRelevant === 0) {
                        results += `<p style="color: #ff4444;"><strong>‚ùå CRITICAL ISSUE: NO COVID-19 PAPERS FOUND!</strong><br>This indicates the research system is not working like Consensus AI</p>`;
                    } else if (covidRelevant >= data.papers.length * 0.7) {
                        results += `<p style="color: #44ff44;"><strong>‚úÖ EXCELLENT: High COVID-19 relevance (>70%)</strong></p>`;
                    } else if (covidRelevant >= data.papers.length * 0.4) {
                        results += `<p style="color: #ffaa44;"><strong>‚ö†Ô∏è MODERATE: Some COVID-19 relevance (40-70%)</strong></p>`;
                    } else {
                        results += `<p style="color: #ff4444;"><strong>‚ùå POOR: Low COVID-19 relevance (<40%)</strong></p>`;
                    }
                    
                    if (totallyIrrelevant > 0) {
                        results += `<p style="color: #ff4444;"><strong>‚ùå WARNING: ${totallyIrrelevant} completely irrelevant papers found!</strong><br>This indicates filtering problems</p>`;
                    }
                    
                } else {
                    results += `<p style="color: #ff4444;">‚ùå NO PAPERS FOUND - Check API and database connections</p>`;
                }
                
                results += `</div>`;
                resultsDiv.innerHTML = results;
                
                console.log('üìã Test completed. Check results above.');
                
            } catch (error) {
                console.error('‚ùå Test failed:', error);
                resultsDiv.innerHTML = `<div class="console">‚ùå Test failed: ${error.message}</div>`;
            }
        }
        
        console.log('üöÄ COVID-19 Research Debug Test Page Loaded');
        console.log('Click the button to run the test or run runDebugTest() in console');
    </script>
</body>
</html>
